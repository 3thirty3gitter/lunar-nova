# Handoff Document: Apex 3D AI Engine

## üöÄ Current Project State
The project is a fully functional, local 3D model generation tool using the **TripoSR** model by Stability AI. It features a premium, glassmorphism-style web interface and a FastAPI backend.

### Key Accomplishments:
- **UI/UX**: Implemented a modern, high-fidelity dark theme with a drag-and-drop upload zone and a responsive 3D viewer.
- **3D Realism**: 
  - Upgraded mesh extraction resolution to **512**.
  - Integrated **Laplacian smoothing** via `trimesh` to remove marching cubes artifacts.
  - Configured high-fidelity rendering in `model-viewer` (soft shadows, HDR exposure, neutral tone-mapping).
- **Interaction Logic**: Corrected rotation axes and implemented an intuitive "drag-to-rotate" model.
- **Backend Stability**: Ensured robust CPU fallback for environments without CUDA and optimized image preprocessing.

## üõ† Technical Architecture
- **Frontend**: Single-page application using `@google/model-viewer` for 3D rendering.
- **Backend**: FastAPI (`app.py`) serving as a REST API for image processing and 3D generation.
- **Engine**: TripoSR-based generation (`engine.py`) with `rembg` for background removal.

### Critical Tuning Parameters (`engine.py`):
- `resolution=512`: Higher resolution for finer mesh detail.
- `threshold=30.0`: Balanced density threshold for realistic volumes (shirt vs. "pill" shape).
- `iterations=15, lamb=0.1`: Smoothing settings to balance surface polish and geometric detail.

### Viewer Settings (`static/index.html`):
- `exposure="0.8"`: Balanced to prevent color washout on 3D models.
- `shadow-intensity="0.4"`: Soft shadows to provide depth without dark artifacts.
- `orbit-sensitivity="-1"`: Ensures interaction follows the "swipe" intuition.

## üìå Known Limitations
- **Generation Time**: Currently running on CPU, which takes ~30-60 seconds per model.
- **Texture Resolution**: The vertex-color approach has limitations for complex patterns; full texture baking requires specific C++ dependencies (`xatlas`, `moderngl`) which may require manual environment setup on Windows.

## üîÆ Future Roadmap & Next Steps
1. **Texture Baking**: Re-attempt the integration of `xatlas` and `moderngl` for ultra-high-resolution texture atlases (2048x2048).
2. **Multi-View Conditioning**: Update `engine.py` to support multiple input images to improve back-surface reconstruction.
3. **PBR Materials**: Research ways to map image material properties (glossiness, metallic) to the 3D model's PBR materials.
4. **Performance**: Investigate OpenVINO or ONNX optimizations for TripoSR to speed up CPU inference.

## üèÉ Keeping the Server Running
To start the engine locally:
```powershell
.\venv\Scripts\python.exe app.py
```
Access the UI at `http://localhost:8000`.

---
*Generated by Antigravity on 2026-02-05*
